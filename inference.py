import argparse
import torch
import re
import numpy as np
import whisper as whsp
from utils import *
import os


def parse_args():
    parser = argparse.ArgumentParser(description="A tool to create readable caption for accessibility purposes.",epilog="example")
    parser.add_argument("filename", help='A media filename. Could be either video (with audio) or audio.')
    parser.add_argument("-o", "--output", type=str, required=True)
    parser.add_argument("--max-words", type=int, default=7, help="Max words")
    parser.add_argument("--max-lines", type=int, default=2)
    parser.add_argument("--model-size", type=str, default="small", help="Model size.")
    parser.add_argument("--device", type=str, default="cpu", help="Device used to render.")
    args = parser.parse_args()
    return args
    print(args.filename)

def main(args):
    #model = whsp.load_model(args.model_size,device=args.device)
    #result = model.transcribe(args.filename,word_timestamps=True,verbose=True)
    #result = {'text': ' ok guys, jadi ini tuh rekaman yang kita lihat itu rekaman yang kita lihat tapi saya ada di sana guys lah, ditanya guys, rekamannya di sini nih, rekamannya mana yang ada? kelas mak, lo bisa kamera lah maximum ambil dengar lo ga ambil tbsp쳤 lah ayo cheese ey ya mau twitter ga lu?', 'segments': [{'id': 0, 'seek': 0, 'start': np.float64(0.7599999999999987), 'end': np.float64(5.44), 'text': ' ok guys, jadi ini tuh rekaman yang kita lihat', 'tokens': [50364, 3133, 1074, 11, 19399, 7408, 26849, 33881, 6147, 5581, 8965, 45153, 50664], 'temperature': 0.0, 'avg_logprob': -0.9435875054561731, 'compression_ratio': 1.7008547008547008, 'no_speech_prob': 0.48044949769973755, 'words': [{'word': ' ok', 'start': np.float64(0.7599999999999987), 'end': np.float64(1.36), 'probability': np.float64(0.06766327470541)}, {'word': ' guys,', 'start': np.float64(1.36), 'end': np.float64(1.86), 'probability': np.float64(0.7475568652153015)}, {'word': ' jadi', 'start': np.float64(2.06), 'end': np.float64(2.88), 'probability': np.float64(0.8814541697502136)}, {'word': ' ini', 'start': np.float64(2.88), 'end': np.float64(3.24), 'probability': np.float64(0.8968604207038879)}, {'word': ' tuh', 'start': np.float64(3.24), 'end': np.float64(3.5), 'probability': np.float64(0.679694652557373)}, {'word': ' rekaman', 'start': np.float64(3.5), 'end': np.float64(4.38), 'probability': np.float64(0.7161627113819122)}, {'word': ' yang', 'start': np.float64(4.38), 'end': np.float64(4.66), 'probability': np.float64(0.81819087266922)}, {'word': ' kita', 'start': np.float64(4.66), 'end': np.float64(5.0), 'probability': np.float64(0.0861423909664154)}, {'word': ' lihat', 'start': np.float64(5.0), 'end': np.float64(5.44), 'probability': np.float64(0.05718865245580673)}]}, {'id': 1, 'seek': 0, 'start': 6.0, 'end': np.float64(7.66), 'text': ' itu rekaman yang kita lihat', 'tokens': [50664, 9032, 33881, 6147, 5581, 8965, 45153, 50764], 'temperature': 0.0, 'avg_logprob': -0.9435875054561731, 'compression_ratio': 1.7008547008547008, 'no_speech_prob': 0.48044949769973755, 'words': [{'word': ' itu', 'start': np.float64(5.839999999999999), 'end': np.float64(6.14), 'probability': np.float64(0.022508498281240463)}, {'word': ' rekaman', 'start': np.float64(6.14), 'end': np.float64(6.44), 'probability': np.float64(0.9355885982513428)}, {'word': ' yang', 'start': np.float64(6.44), 'end': np.float64(6.62), 'probability': np.float64(0.15781426429748535)}, {'word': ' kita', 'start': np.float64(6.62), 'end': np.float64(6.76), 'probability': np.float64(0.7614261507987976)}, {'word': ' lihat', 'start': np.float64(6.76), 'end': np.float64(7.66), 'probability': np.float64(0.8343254923820496)}]}, {'id': 2, 'seek': 0, 'start': np.float64(12.139999999999999), 'end': np.float64(13.88), 'text': ' tapi saya ada di sana guys', 'tokens': [50964, 23901, 9160, 11063, 1026, 15490, 1074, 51064], 'temperature': 0.0, 'avg_logprob': -0.9435875054561731, 'compression_ratio': 1.7008547008547008, 'no_speech_prob': 0.48044949769973755, 'words': [{'word': ' tapi', 'start': np.float64(12.139999999999999), 'end': np.float64(12.74), 'probability': np.float64(0.03909764811396599)}, {'word': ' saya', 'start': np.float64(12.74), 'end': np.float64(12.9), 'probability': np.float64(0.6905045509338379)}, {'word': ' ada', 'start': np.float64(12.9), 'end': np.float64(13.0), 'probability': np.float64(0.6920821666717529)}, {'word': ' di', 'start': np.float64(13.0), 'end': np.float64(13.12), 'probability': np.float64(0.661695122718811)}, {'word': ' sana', 'start': np.float64(13.12), 'end': np.float64(13.26), 'probability': np.float64(0.9810927510261536)}, {'word': ' guys', 'start': np.float64(13.26), 'end': np.float64(13.88), 'probability': np.float64(0.8008230924606323)}]}, {'id': 3, 'seek': 0, 'start': np.float64(15.139999999999999), 'end': np.float64(18.42), 'text': ' lah, ditanya guys, rekamannya di sini nih, rekamannya', 'tokens': [51114, 26532, 11, 6176, 8791, 1074, 11, 33881, 6147, 7457, 1026, 30368, 27438, 11, 33881, 6147, 7457, 51264], 'temperature': 0.0, 'avg_logprob': -0.9435875054561731, 'compression_ratio': 1.7008547008547008, 'no_speech_prob': 0.48044949769973755, 'words': [{'word': ' lah,', 'start': np.float64(15.139999999999999), 'end': np.float64(15.74), 'probability': np.float64(0.0826508179306984)}, {'word': ' ditanya', 'start': np.float64(15.84), 'end': np.float64(16.06), 'probability': np.float64(0.47389423102140427)}, {'word': ' guys,', 'start': np.float64(16.06), 'end': np.float64(16.38), 'probability': np.float64(0.5228576064109802)}, {'word': ' rekamannya', 'start': np.float64(16.44), 'end': np.float64(16.88), 'probability': np.float64(0.7606773376464844)}, {'word': ' di', 'start': np.float64(16.88), 'end': np.float64(17.04), 'probability': np.float64(0.2796252369880676)}, {'word': ' sini', 'start': np.float64(17.04), 'end': np.float64(17.28), 'probability': np.float64(0.9754485487937927)}, {'word': ' nih,', 'start': np.float64(17.28), 'end': np.float64(17.4), 'probability': np.float64(0.10150957852602005)}, {'word': ' rekamannya', 'start': np.float64(17.4), 'end': np.float64(18.42), 'probability': np.float64(0.8766084313392639)}]}, {'id': 4, 'seek': 0, 'start': np.float64(18.42), 'end': np.float64(21.3), 'text': ' mana yang ada?', 'tokens': [51414, 21225, 5581, 11063, 30, 51464], 'temperature': 0.0, 'avg_logprob': -0.9435875054561731, 'compression_ratio': 1.7008547008547008, 'no_speech_prob': 0.48044949769973755, 'words': [{'word': ' mana', 'start': np.float64(18.42), 'end': np.float64(19.48), 'probability': np.float64(0.5653480887413025)}, {'word': ' yang', 'start': np.float64(19.48), 'end': np.float64(19.48), 'probability': np.float64(0.04689611867070198)}, {'word': ' ada?', 'start': np.float64(19.48), 'end': np.float64(21.3), 'probability': np.float64(0.1658766120672226)}]}, {'id': 5, 'seek': 0, 'start': np.float64(24.68), 'end': np.float64(25.28), 'text': ' kelas', 'tokens': [51564, 803, 7743, 51664], 'temperature': 0.0, 'avg_logprob': -0.9435875054561731, 'compression_ratio': 1.7008547008547008, 'no_speech_prob': 0.48044949769973755, 'words': [{'word': ' kelas', 'start': np.float64(24.68), 'end': np.float64(25.28), 'probability': np.float64(0.09695433732122183)}]}, {'id': 6, 'seek': 0, 'start': np.float64(25.28), 'end': np.float64(27.38), 'text': ' mak, lo bisa kamera lah', 'tokens': [51664, 963, 11, 450, 14386, 43246, 26532, 51764], 'temperature': 0.0, 'avg_logprob': -0.9435875054561731, 'compression_ratio': 1.7008547008547008, 'no_speech_prob': 0.48044949769973755, 'words': [{'word': ' mak,', 'start': np.float64(25.28), 'end': np.float64(25.84), 'probability': np.float64(0.0002840643282979727)}, {'word': ' lo', 'start': np.float64(26.52), 'end': np.float64(26.78), 'probability': np.float64(0.6705866456031799)}, {'word': ' bisa', 'start': np.float64(26.78), 'end': np.float64(26.9), 'probability': np.float64(0.27225351333618164)}, {'word': ' kamera', 'start': np.float64(26.9), 'end': np.float64(27.2), 'probability': np.float64(0.5052986145019531)}, {'word': ' lah', 'start': np.float64(27.2), 'end': np.float64(27.38), 'probability': np.float64(0.21300925314426422)}]}, {'id': 7, 'seek': 3000, 'start': np.float64(30.139999999999997), 'end': np.float64(30.9), 'text': ' maximum', 'tokens': [50364, 6674, 50424], 'temperature': 1.0, 'avg_logprob': -4.374106204870976, 'compression_ratio': 1.0256410256410255, 'no_speech_prob': 0.029028400778770447, 'words': [{'word': ' maximum', 'start': np.float64(30.139999999999997), 'end': np.float64(30.9), 'probability': np.float64(2.5708743578434223e-06)}]}, {'id': 8, 'seek': 3000, 'start': np.float64(30.9), 'end': np.float64(31.44), 'text': ' ambil dengar', 'tokens': [50424, 3913, 388, 1441, 2976, 50486], 'temperature': 1.0, 'avg_logprob': -4.374106204870976, 'compression_ratio': 1.0256410256410255, 'no_speech_prob': 0.029028400778770447, 'words': [{'word': ' ambil', 'start': np.float64(30.9), 'end': np.float64(31.3), 'probability': np.float64(0.3918703685631044)}, {'word': ' dengar', 'start': np.float64(31.3), 'end': np.float64(31.44), 'probability': np.float64(0.14815377566264942)}]}, {'id': 9, 'seek': 3000, 'start': np.float64(31.44), 'end': np.float64(33.78), 'text': ' lo ga ambil tbsp쳤 lah', 'tokens': [50486, 450, 5959, 3913, 388, 25110, 43445, 26532, 50578], 'temperature': 1.0, 'avg_logprob': -4.374106204870976, 'compression_ratio': 1.0256410256410255, 'no_speech_prob': 0.029028400778770447, 'words': [{'word': ' lo', 'start': np.float64(31.44), 'end': np.float64(31.8), 'probability': np.float64(0.0006753982743248343)}, {'word': ' ga', 'start': np.float64(31.8), 'end': np.float64(31.94), 'probability': np.float64(0.01405950728803873)}, {'word': ' ambil', 'start': np.float64(31.94), 'end': np.float64(32.98), 'probability': np.float64(0.4905160711496137)}, {'word': ' tbsp쳤', 'start': np.float64(32.98), 'end': np.float64(33.78), 'probability': np.float64(7.5874104439321854e-06)}, {'word': ' lah', 'start': np.float64(33.78), 'end': np.float64(33.78), 'probability': np.float64(0.004703457001596689)}]}, {'id': 10, 'seek': 3000, 'start': np.float64(33.78), 'end': np.float64(35.12), 'text': ' ayo cheese', 'tokens': [50578, 7494, 78, 5399, 50628], 'temperature': 1.0, 'avg_logprob': -4.374106204870976, 'compression_ratio': 1.0256410256410255, 'no_speech_prob': 0.029028400778770447, 'words': [{'word': ' ayo', 'start': np.float64(33.78), 'end': np.float64(35.04), 'probability': np.float64(0.4705103859305382)}, {'word': ' cheese', 'start': np.float64(35.04), 'end': np.float64(35.12), 'probability': np.float64(0.0044590444304049015)}]}, {'id': 11, 'seek': 3000, 'start': np.float64(37.42), 'end': np.float64(39.86), 'text': ' ey ya mau twitter ga lu?', 'tokens': [50894, 9817, 2478, 22074, 21439, 5959, 10438, 30, 50994], 'temperature': 1.0, 'avg_logprob': -4.374106204870976, 'compression_ratio': 1.0256410256410255, 'no_speech_prob': 0.029028400778770447, 'words': [{'word': ' ey', 'start': np.float64(37.42), 'end': np.float64(38.18), 'probability': np.float64(0.00016871911066118628)}, {'word': ' ya', 'start': np.float64(38.18), 'end': np.float64(38.32), 'probability': np.float64(0.02655891515314579)}, {'word': ' mau', 'start': np.float64(38.32), 'end': np.float64(39.24), 'probability': np.float64(0.0015141856856644154)}, {'word': ' twitter', 'start': np.float64(39.24), 'end': np.float64(39.38), 'probability': np.float64(2.790109283523634e-05)}, {'word': ' ga', 'start': np.float64(39.38), 'end': np.float64(39.54), 'probability': np.float64(0.028600899502635002)}, {'word': ' lu?', 'start': np.float64(39.54), 'end': np.float64(39.86), 'probability': np.float64(0.0009520495659671724)}]}], 'language': 'id'}

    result = {'text': ' Assalamualaikum Ini dari kelompoknya Dafa, Yuga, Ahmad dan Septiaan akan membuat rangkaian panel lampu disini bahan-bahannya adalah 2 kardus dengan ukuran 50 cm dan 20 cm dan rangkaian lampu, kabel, saklar dan pelalatan lainnya kita mulai dengan membuat ruangan-ruangan untuk dibasang lampu pada silembar kardus juga akan mulai menggaris ruangan-ruangan', 'segments': [{'id': 0, 'seek': 0, 'start': np.float64(0.0), 'end': np.float64(1.26), 'text': ' Assalamualaikum', 'tokens': [50364, 6281, 23819, 901, 64, 35518, 50464], 'temperature': 0.0, 'avg_logprob': -0.27906531321851513, 'compression_ratio': 1.404109589041096, 'no_speech_prob': 0.03757919371128082, 'words': [{'word': ' Assalamualaikum', 'start': np.float64(0.0), 'end': np.float64(1.26), 'probability': np.float64(0.9279126524925232)}]}, {'id': 1, 'seek': 0, 'start': 2.0, 'end': np.float64(9.32), 'text': ' Ini dari kelompoknya Dafa, Yuga, Ahmad dan Septiaan', 'tokens': [50464, 28929, 15597, 31332, 8586, 453, 7457, 413, 19846, 11, 398, 19364, 11, 35911, 3277, 22012, 83, 654, 282, 50814], 'temperature': 0.0, 'avg_logprob': -0.27906531321851513, 'compression_ratio': 1.404109589041096, 'no_speech_prob': 0.03757919371128082, 'words': [{'word': ' Ini', 'start': np.float64(1.7299999999999986), 'end': np.float64(2.42), 'probability': np.float64(0.02413390949368477)}, {'word': ' dari', 'start': np.float64(2.42), 'end': np.float64(2.7), 'probability': np.float64(0.8756030201911926)}, {'word': ' kelompoknya', 'start': np.float64(2.7), 'end': np.float64(3.34), 'probability': np.float64(0.9616739600896835)}, {'word': ' Dafa,', 'start': np.float64(3.34), 'end': np.float64(4.14), 'probability': np.float64(0.4723765105009079)}, {'word': ' Yuga,', 'start': np.float64(4.92), 'end': np.float64(5.42), 'probability': np.float64(0.9235596656799316)}, {'word': ' Ahmad', 'start': np.float64(6.84), 'end': np.float64(7.32), 'probability': np.float64(0.774175226688385)}, {'word': ' dan', 'start': np.float64(7.32), 'end': np.float64(8.08), 'probability': np.float64(0.8465126752853394)}, {'word': ' Septiaan', 'start': np.float64(8.08), 'end': np.float64(9.32), 'probability': np.float64(0.5616497993469238)}]}, {'id': 2, 'seek': 0, 'start': np.float64(9.32), 'end': np.float64(12.88), 'text': ' akan membuat rangkaian panel lampu', 'tokens': [50814, 16281, 1334, 45143, 32434, 2330, 952, 4831, 12684, 84, 51014], 'temperature': 0.0, 'avg_logprob': -0.27906531321851513, 'compression_ratio': 1.404109589041096, 'no_speech_prob': 0.03757919371128082, 'words': [{'word': ' akan', 'start': np.float64(9.32), 'end': np.float64(9.54), 'probability': np.float64(0.8879114389419556)}, {'word': ' membuat', 'start': np.float64(9.54), 'end': np.float64(10.16), 'probability': np.float64(0.9904484152793884)}, {'word': ' rangkaian', 'start': np.float64(10.16), 'end': np.float64(11.1), 'probability': np.float64(0.8409827947616577)}, {'word': ' panel', 'start': np.float64(11.1), 'end': np.float64(11.78), 'probability': np.float64(0.7569506168365479)}, {'word': ' lampu', 'start': np.float64(11.78), 'end': np.float64(12.88), 'probability': np.float64(0.975507915019989)}]}, {'id': 3, 'seek': 0, 'start': 14.0, 'end': np.float64(16.62), 'text': ' disini bahan-bahannya adalah', 'tokens': [51064, 717, 3812, 12913, 282, 12, 65, 21436, 7457, 23555, 51214], 'temperature': 0.0, 'avg_logprob': -0.27906531321851513, 'compression_ratio': 1.404109589041096, 'no_speech_prob': 0.03757919371128082, 'words': [{'word': ' disini', 'start': np.float64(13.95), 'end': np.float64(14.64), 'probability': np.float64(0.6025364473462105)}, {'word': ' bahan', 'start': np.float64(14.64), 'end': np.float64(15.68), 'probability': np.float64(0.7965144217014313)}, {'word': '-bahannya', 'start': np.float64(15.68), 'end': np.float64(16.14), 'probability': np.float64(0.6561167910695076)}, {'word': ' adalah', 'start': np.float64(16.14), 'end': np.float64(16.62), 'probability': np.float64(0.9803215861320496)}]}, {'id': 4, 'seek': 0, 'start': np.float64(16.62), 'end': np.float64(23.28), 'text': ' 2 kardus dengan ukuran 50 cm dan 20 cm', 'tokens': [51214, 568, 350, 515, 301, 13877, 26769, 12125, 2625, 14668, 3277, 945, 14668, 51514], 'temperature': 0.0, 'avg_logprob': -0.27906531321851513, 'compression_ratio': 1.404109589041096, 'no_speech_prob': 0.03757919371128082, 'words': [{'word': ' 2', 'start': np.float64(16.62), 'end': np.float64(18.12), 'probability': np.float64(0.6211333274841309)}, {'word': ' kardus', 'start': np.float64(18.12), 'end': np.float64(19.48), 'probability': np.float64(0.8584512074788412)}, {'word': ' dengan', 'start': np.float64(19.48), 'end': np.float64(19.8), 'probability': np.float64(0.9123279452323914)}, {'word': ' ukuran', 'start': np.float64(19.8), 'end': np.float64(20.24), 'probability': np.float64(0.9874018132686615)}, {'word': ' 50', 'start': np.float64(20.24), 'end': np.float64(20.72), 'probability': np.float64(0.9802123308181763)}, {'word': ' cm', 'start': np.float64(20.72), 'end': np.float64(21.3), 'probability': np.float64(0.7707675695419312)}, {'word': ' dan', 'start': np.float64(21.3), 'end': np.float64(22.12), 'probability': np.float64(0.9525002837181091)}, {'word': ' 20', 'start': np.float64(22.12), 'end': np.float64(22.58), 'probability': np.float64(0.9159659743309021)}, {'word': ' cm', 'start': np.float64(22.58), 'end': np.float64(23.28), 'probability': np.float64(0.9877135753631592)}]}, {'id': 5, 'seek': 0, 'start': np.float64(23.28), 'end': np.float64(28.62), 'text': ' dan rangkaian lampu, kabel, saklar', 'tokens': [51514, 3277, 32434, 2330, 952, 12684, 84, 11, 350, 18657, 11, 23366, 2200, 51814], 'temperature': 0.0, 'avg_logprob': -0.27906531321851513, 'compression_ratio': 1.404109589041096, 'no_speech_prob': 0.03757919371128082, 'words': [{'word': ' dan', 'start': np.float64(23.28), 'end': np.float64(23.68), 'probability': np.float64(0.8067819476127625)}, {'word': ' rangkaian', 'start': np.float64(23.68), 'end': np.float64(24.44), 'probability': np.float64(0.946118434270223)}, {'word': ' lampu,', 'start': np.float64(24.44), 'end': np.float64(26.08), 'probability': np.float64(0.9444206058979034)}, {'word': ' kabel,', 'start': np.float64(26.6), 'end': np.float64(27.12), 'probability': np.float64(0.9842383563518524)}, {'word': ' saklar', 'start': np.float64(28.02), 'end': np.float64(28.62), 'probability': np.float64(0.8690430223941803)}]}, {'id': 6, 'seek': 2862, 'start': np.float64(28.62), 'end': np.float64(30.98), 'text': ' dan pelalatan lainnya', 'tokens': [50364, 3277, 6178, 304, 25649, 29272, 7457, 50514], 'temperature': 0.0, 'avg_logprob': -0.22137819803678072, 'compression_ratio': 1.4554455445544554, 'no_speech_prob': 0.030722377821803093, 'words': [{'word': ' dan', 'start': np.float64(28.62), 'end': np.float64(29.54), 'probability': np.float64(0.15108072757720947)}, {'word': ' pelalatan', 'start': np.float64(29.54), 'end': np.float64(30.3), 'probability': np.float64(0.8106580873330435)}, {'word': ' lainnya', 'start': np.float64(30.3), 'end': np.float64(30.98), 'probability': np.float64(0.9231867492198944)}]}, {'id': 7, 'seek': 2862, 'start': 31.62, 'end': np.float64(36.24), 'text': ' kita mulai dengan membuat ruangan-ruangan', 'tokens': [50514, 8965, 14077, 1301, 13877, 1334, 45143, 5420, 17017, 12, 894, 17017, 50714], 'temperature': 0.0, 'avg_logprob': -0.22137819803678072, 'compression_ratio': 1.4554455445544554, 'no_speech_prob': 0.030722377821803093, 'words': [{'word': ' kita', 'start': np.float64(31.459999999999997), 'end': np.float64(32.16), 'probability': np.float64(0.2318362295627594)}, {'word': ' mulai', 'start': np.float64(32.16), 'end': np.float64(32.96), 'probability': np.float64(0.9922191500663757)}, {'word': ' dengan', 'start': np.float64(32.96), 'end': np.float64(33.36), 'probability': np.float64(0.967979371547699)}, {'word': ' membuat', 'start': np.float64(33.36), 'end': np.float64(35.0), 'probability': np.float64(0.9780726730823517)}, {'word': ' ruangan', 'start': np.float64(35.0), 'end': np.float64(35.82), 'probability': np.float64(0.9938078224658966)}, {'word': '-ruangan', 'start': np.float64(35.82), 'end': np.float64(36.24), 'probability': np.float64(0.8645320534706116)}]}, {'id': 8, 'seek': 2862, 'start': np.float64(36.24), 'end': np.float64(40.32), 'text': ' untuk dibasang lampu pada silembar kardus', 'tokens': [50714, 12711, 23064, 296, 656, 12684, 84, 26069, 262, 794, 76, 5356, 350, 515, 301, 50964], 'temperature': 0.0, 'avg_logprob': -0.22137819803678072, 'compression_ratio': 1.4554455445544554, 'no_speech_prob': 0.030722377821803093, 'words': [{'word': ' untuk', 'start': np.float64(36.24), 'end': np.float64(36.58), 'probability': np.float64(0.9671875238418579)}, {'word': ' dibasang', 'start': np.float64(36.58), 'end': np.float64(37.16), 'probability': np.float64(0.9709833661715189)}, {'word': ' lampu', 'start': np.float64(37.16), 'end': np.float64(37.52), 'probability': np.float64(0.9863198101520538)}, {'word': ' pada', 'start': np.float64(37.52), 'end': np.float64(37.92), 'probability': np.float64(0.9321114420890808)}, {'word': ' silembar', 'start': np.float64(37.92), 'end': np.float64(39.7), 'probability': np.float64(0.39144881069660187)}, {'word': ' kardus', 'start': np.float64(39.7), 'end': np.float64(40.32), 'probability': np.float64(0.9132222731908163)}]}, {'id': 9, 'seek': 2862, 'start': np.float64(40.32), 'end': np.float64(44.98), 'text': ' juga akan mulai menggaris ruangan-ruangan', 'tokens': [50964, 14462, 16281, 14077, 1301, 15330, 2976, 271, 5420, 17017, 12, 894, 17017, 51164], 'temperature': 0.0, 'avg_logprob': -0.22137819803678072, 'compression_ratio': 1.4554455445544554, 'no_speech_prob': 0.030722377821803093, 'words': [{'word': ' juga', 'start': np.float64(40.32), 'end': np.float64(41.66), 'probability': np.float64(0.8415486216545105)}, {'word': ' akan', 'start': np.float64(41.66), 'end': np.float64(42.06), 'probability': np.float64(0.9658237099647522)}, {'word': ' mulai', 'start': np.float64(42.06), 'end': np.float64(43.0), 'probability': np.float64(0.958591639995575)}, {'word': ' menggaris', 'start': np.float64(43.0), 'end': np.float64(44.02), 'probability': np.float64(0.8466513752937317)}, {'word': ' ruangan', 'start': np.float64(44.02), 'end': np.float64(44.84), 'probability': np.float64(0.9894112646579742)}, {'word': '-ruangan', 'start': np.float64(44.84), 'end': np.float64(44.98), 'probability': np.float64(0.7661996086438497)}]}], 'language': 'id'}


    #print(result["segments"][2]["words"])
    '''grid = result["segments"]
    print(grid)'''
    #formatter
    def get_word_timestamps(transcription):
        out = []
        segments = transcription["segments"]
        for segment in segments:
            for word_index in segment["words"]:
                word=word_index["word"]
                start=float(word_index["start"])
                end=float(word_index["end"])
                out.append({"word": word, "start":round(start,3), "end":round(end,3)})
        return out

    def get_text(transcription):
        out = []
        segments = transcription["segments"]
        for segment in segments:
            start=float(segment["start"])
            end=float(segment["end"])
            word=segment["text"]
            out.append({"word":word,"start":round(start,3), "end":round(end,3)})
        return out

    def split_by_word_limit(segments, max_words=5):
        out = []
        for segment in segments:
            words = segment["word"].split()
            start = segment["start"]
            end   = segment["end"]

            if not words:
                continue

            if len(words) == 1:
                out.append({"word": words[0], "start": round(start, 3), "end": round(end, 3)})
                continue

            total_words = len(words)
            duration = end - start
            step = duration / total_words

            chunks = []
            for i in range(0, total_words, max_words):
                chunks.append(words[i:i+max_words])

            if len(chunks) > 1 and len(chunks[-1]) == 1:
                last_word = chunks[-1][0]
                prev_chunk = chunks[-2]

                moved_word = prev_chunk.pop()
                chunks[-1] = [moved_word, last_word]
            word_index = 0
            for chunk in chunks:
                chunk_start = start + word_index * step
                chunk_end   = start + (word_index + len(chunk)) * step
                out.append({"word": " ".join(chunk), "start":round(chunk_start,3), "end":round(chunk_end,3)})
                word_index += len(chunk)
        return out

    #print(result)
    words=get_word_timestamps(result)
    texts=get_text(result)
    texts=split_by_word_limit(texts)
    aligned=align_segments_to_words(texts,words)
    #print(words,"\n",texts)
    #for s in aligned: print(s)
    print(aligned)
    # split_segment_by_words(words)

    #print(text)
    #write_srt(text, args.output)

    '''word_options = {
        "word_timestamps": True,
        "max_words_per_line": 1
    }
    srt_writer = whsp.utils.get_writer(output_format='srt', output_dir=os.path.dirname(args.output))
    srt_writer(result, args.filename, word_options)'''

if __name__ == "__main__":
    args = parse_args()
    if args.max_words == 2 and args.max_lines == 1:
        if warning_sign("Caution: This will inevitably create single-word captions.\nASIF cannot condone misuse of this option.\nDo you want to continue?"):
            main(args)
    else:
        main(args)
    #transcribe(args.filename)
